# 计算机安全基本概念

## 计算机安全的特点

- 没有绝对的安全
- 安全是一个动态实践的过程，安全问题的解决，必须重视整体系统结构的规划和安全策略的指定
- 人是安全机制中最薄弱环节



## 安全属性CIA

- 机密性confidentiality：对信息或资源的隐藏，使得信息不被未授权者访问
- 完整性：网络中传输的信息数据必须保持初始状态，没有第三方能够修改数据内容、所有资源只能由授权方或以授权的方式进行修改。**保证收到的数据是授权实体所发出的数据**

- 可用性：所有的资源在适当的时候可以由授权方访问。备份、资源冗余、灾难恢复等方式保证

其他

- 真实性：保证信息的真实性，包括实体身份的认证、消息源的认证

- 不可否认性：防止任一通信实体否认行为

  当发方发送信息时，收方能够证明信息源合法。当收方接到信息时，发方能够证明信息目的地合法

  源不可否认：向数据收到者提供数据源的证据（即发方的签名），可防止发送者否认发送过这个数据

  宿不可否认：向数据发送者提供数据已交付给接收者的证据（即接收方的回执），可防止接收者事后否认曾收到过次数据



威胁：

- 外因 计算机病毒，黑客
- 内因：系统在设计、实现和管理中的缺陷。如软件漏洞、IPV4协议没有考虑安全性、缺省安装、弱口令

威胁发起者：业余爱好者，激进黑客，有组织的犯罪团伙，国家资助的黑客和恐怖组织

- 业余爱好者：脚本小子，没啥技能，用的是现有工具
- 激进黑客
  - 白（正义）、黑（非法获取个人、经济、政治利益）、灰帽（）



## 攻击描述和防御框架

安全攻击实施方式：

- 技术
- 社会工程学方式：非技术手段获得未经授权的访问

安全攻击分类

- 主动攻击：试图改变系统资源或影响其运行
  - 篡改：修改数据，破坏系统和数据的完整性
  - 重演：捕获一个数据单元，在以后的某个时机重传
  - 伪造：假冒另一个实体发送信息。破坏真实性
  - 拒绝服务：通过耗尽目标系统的资源，危害目标系统的正常使用
- 被动攻击：试图从系统中学习、或者利用系统信息，但不影响系统资源
  - 窃听
  - 流量分析

**受攻击面：攻击者可访问的给定系统中所有漏洞的集合**

- 如服务器或者主机上的开放端口
- 面向互联王的服务器上运行的软件
- 无线网络协议甚至用户

攻击面分类

- 网络受攻击面
- 软件受攻击面
- 人类受攻击面

攻击树

![image-20221029163730209](img/image-20221029163730209.png)

纵深防御的概念
>定义:通过设置多层重叠的安全防护系统而构成多道防线，使得即使某一防线失效也能被其他防线弥补或纠正。
>分类:安全洋葱法、安全洋蓟法

安全洋葱法Security Onion

- 是一种**有边界**、分层次的安全纵深防御方法

- 威胁发起者必须以类似于剥洋葱的方式剥掉网络的防御机制

安全洋蓟法Security Artichoke

- 是一种**无边界**网络安全的纵深防御方法

- 威胁发起者不需要剥掉每一层，只需去掉某些“洋蓟叶子"，就可到达洋蓟的中心，直击企业的“心脏"。



## 评估准则

安全评估准则

- 可信计算机系统评估准则TCSEC (Trusted Computer Security EvaluationCriteria)

- 信息技术安全评估准则ITSEc (Information Technology SecurityEvaluation Criteria )

- 信息技术安全评价通用准则cc (Information security common criteria)



**TCSEC（桔皮书）**

TDI（紫皮书）

TNI（红皮书）

**ITSEC（欧洲白皮书）**

![image-20221029164539213](img/image-20221029164539213-16670331409391.png)





TCSEC的缺点

- 静态模型。TCSEC针对孤立计算机系统，特别是小型机和主机系统，只考虑保密性。
- 美国国家计算机安全中心NCSC的TNI把TCSEC的思想用到网络上，但缺少成功实践的支持。
- TCSEC模型不能适应计算机发展的规律。



我国颁发的《计算机信息系统安全保护等级划分准则》,将计算机安全保护划分为**5个级别。**

## 安全原则

- 最易渗透

  入侵者总是企图利用任何可能的入侵手段

  受否安全，必须考虑所有可能的入侵方式

- 适度保护

  被保护的程度与价值一致

- 有效性保护

  控制措施高效，易使用，适当

  控制使用不影响被保护任务

- 最弱环节

  绝对安全措施的强度



安全设计原则

- 经济机制

  嵌入在软硬件中的安全机制设计要简单、短小

- 安全缺省设置

  访问控制基于许可，默认条件=deny 默认不信任

- 绝对中介

  安全仲裁

- 开放式设计

  接收广泛的公开审查

- 特权分离和最小特权

  

- 最小公共机制

- 心理可接受性

  安全机制不应该过度干涉用户的工作，同时也要满足用户授权访问的要求。

  易用性，能促进广泛采用

- 隔离

- 封装

- 模块化



通过对系统功能或数据的不利修改对系统运行进行非期望的改变导致的威胁后果是破坏

敏感数据被直接泄露给非授权实体导致的威胁后果是非授权泄露

中间人攻击涉及说服用户和访问点相信他们正在互相交谈,而实际上通信正在通过中间攻击设备。

OSI安全体系结构专注于安全攻击,机制/安全机制和服务。



# 密码

公元前400年古希腊人发明斯巴达密码棒Scytale 密钥就是特定直径的棒

![image-20221029171527609](img/image-20221029171527609.png)



凯撒密码中,每个字母被其后第几位的字母替换?(3)

## 古典算法

### 代换

明文中每一个字符被替换成密文中的另外一个字符。

- 单字母，凯撒Caesar密码
- 多字母，Playfair Hill



![image-20221029182401878](img/image-20221029182401878.png)





**Hill**

![image-20221029181832715](img/image-20221029181832715.png)



### 置换算法

通过对明文字母的置换，密文为一种类型完全不同的映射

就是打乱排序

### 多重加密



### 隐写术

除密码学外的另一种隐藏信息存在的技术，将信息隐藏到其他信息中。

隐藏方式:

- 用—整段信息中单词或字母的子集来表达隐含信息
- 用不可见的墨水
- 藏在图像或声音文件中





## 对称密码算法

定义：加密和解密使用的密钥是相同的，算法的安全性依赖于密钥

分类

- 流密码：一次只对明文中的一位或者一个字节进行加解密
- 分组密码：对固定长度的明文块进行加密解密

### 分组密码的基本设计

混乱：基于代换操作实践，非线性变换，密文和密钥（或者明文）之间的函数关系尽量复杂

扩散：基于置换，线性变换，将明文的统计特诊和结构规律分散到密文中

### 基本结构设计

#### SPN

n比特明文经过多重代换-置换迭代得到n比特密文

每一次迭代的操作：异或运算，分组代换，单比特置换

AES采用这个结构

#### Feistel

另一种多重代换-置换网络

大多数重要对称分组加密算法采用的结构。如DES算法

- 将明文分为两半，经过多轮处理后合成为密文组
- 每轮
  - 对左半数据进行一次代换：将右半数据和本轮密钥做F函数的映射，再将结果和左半数据进行异或，得到新的左半数据
  - 将左右两半进行置换操作

**SDES**

![image-20221029203802527](img/image-20221029203802527.png)

图片中P8操作。下面的那行没有1和2表示第一和第二被舍弃。==实际上P8下一行对应的是原来那十个数中的位数，不用看第一行，直接对应第二行就行==



### 常用的对称算法

#### 三种分组密码

![image-20221029204437165](img/image-20221029204437165.png)



#### 两种流密码

- 软件优化加密算法(SEAL):一种使用160位加密密钥的流密码。.

- Rivest 流密码(RC)系列算法（包括RC2、RC4、RC5 和 RC6）

  - RC4 流密码算法广泛应用于SSL/TLS协议和 WEP/WPA 无线局域网认证协议，速度可以达到DES加密的10倍左右。

  - RC2,RC5,RC6为分组密码。

    - RC2可作为DES算法的建议替代算法，输入和输出都是64比特，密钥的长度是从1字节到128字节可变。

    - RC6是RC5的改进算法。



## 密码工作模式

### 电码本ECB

简单、有效、可并行

没有误差传递现象

不能隐藏明文的模式信息，只适合短消息传输

明文易收到主动攻击

<img src="img/image-20221029210721021.png" alt="image-20221029210721021" style="zoom:50%;" />

### 密文分组链接CBC

<img src="img/image-20221029223355989.png" alt="image-20221029223355989" style="zoom:50%;" />

解决ECB的缺陷：相同明文分组，不一定密文分组相同

应用场景：传输长度大于64位的报文，消息认证

CBC存在误差传递

- 如一个CBC密文分组损坏
  - 密文分组长度不变：解密时，最多影响2个明文分组
  - 变化时有比特缺失：会影响后续的所有



### 密文反馈CFB

![image-20221029230936926](img/image-20221029230936926.png)

CFB-1：流明文Pi是1bit

CFB-8：流明文Pi是8bit

CFB-64：流明文Pi是64bit

无论加密还是解密，CFB只有分组加密算法

CFB是一种使用分组密码实现流密码的方式

存在误差传递

![image-20221029231329546](img/image-20221029231329546.png)

### 输出反馈OFB

![image-20221029231154024](img/image-20221029231154024.png)

无误差传递

![image-20221029231308316](img/image-20221029231308316.png)



### 计数器CTR

![image-20221029231425646](img/image-20221029231425646.png)



## 公钥密码

对称密码的问题

- N个用户通信，需要需要密钥个数N(N-1)/2
- 不能用于数字签名（身份认证）

加密和解密使用不同的密钥完成

私钥：不公开，可用来签名

公钥：公开，用来验证签名 

N个用户需要2N个密钥

知道加密算法，从加密密钥得到解密密钥上计算上不可行

### 数学基础

完整的剩余类:对数进行模n算术运算时，相同余数（如0,1..n-1 )
在一个类中，共有n个剩余类
剩余的约化集:剩余类中与n互素的那些剩余类。
Euler函数:剩余的约化集中，集合元素的个数。即所有小于n的且与n互素的正整数的个数，记为Ф(n)。

![image-20221029235408806](img/image-20221029235408806.png)



素数的本原根定义:如果a是素数n的本原根，则数 a mod n, a2 mod n, .…, an-1 mod n 是不同的并且包含1到n-1的整数的某种排列。

离散对数

求幂的逆向问题就是找到一个数模p的离散对数

y≡a^x^ mod p 则x≡ log~a~ y mod p

仅当a是p的本源根时，才存在唯一的、以a为底 模p的y的离散对数x

加法逆元(x+y)mod n=0

乘法逆元(x*y)mod n=1

### RSA算法

收发双方均已知n，发送方已知e，接收方已知d，其中: n=pq, p和q是不相等素数，n通常为1024位二进制数或309位十进制数。

RSA密钥创建过程:

- Ф(n)=Ф(pq)=(p-1)(q-1)

- 2)任选一个e,1< e < Ф(n),且与Ф(n)互素

- 3）求d,1< d< Ф(n),且ed是模Ф(n)的乘法逆元 ed=1(mod Ф(n))得到:公钥KU= {e,n}，私钥KR= {d,n}

- 假设明文分组m，密文分组c，加解密过程:加密:c=m^e^ mod n解密:m=c^d^mod n

  加解密算法相同,仅仅使用的密钥不同



两个密文c1和c2相乘后得到的新密文c就是明文m1×m2的密文c
选择密文攻击:如果用户选择一些密文以及它们对应的明文，就可得到密文相乘以后的密文所对应的明文。



## 公钥管理

### 公钥的分发

- 用户公开发布。用户分发公钥，或在一定范围内广播
- 公开可访问目录
- 公钥授权
- 公钥证书

### 基于秘密信道的对称密钥分发

数字信封

基于对称密码算法的Needham-Schroeder协议

Diffie-Hellman密钥交换算法







# 认证理论和技术

## 消息认证

### 消息认证码函数

MAC=C~k~(M)

M：变长的消息

MAC：定长的消息认证码

K：共享的密钥

### 数据认证算法DAA

![image-20221103125846908](img/image-20221103125846908.png)

### 基于密码的消息认证码CMAC

![image-20221103125954014](img/image-20221103125954014.png)



## 消息摘要函数

hash

![image-20221103130205456](img/image-20221103130205456.png)

SHA 算法

![image-20221103130236790](img/image-20221103130236790.png)



## 基于密钥hash函数的MAC算法





# 软件安全

## 缓冲区溢出

大量的输入被放置到缓冲区或数据存储区，超过其所分配的存储能力，覆盖其他信息。攻击者利用这样的状况破坏系统或插入特别编制的代码以获得系统的控制权。

T0：漏洞被发现点

T1：漏洞信息发布点

T2：漏洞被修补点

0-day：已经被发现（未被公开），而官方还没有相关补丁的漏洞，攻击有效性最强

1-day：刚公布后的漏洞，或公布后未打补丁的漏洞，攻击有效性较好

2-day：公布很久，流传很广的漏洞，攻击有效性随时间大幅下降

溢出原因：

- 冯洛伊曼体系结构中的代码和数据混合存储,没有严格区分用户数据和程序控制指令
- 部分编程语言（如C、C++)具有直接访问内存的能力。

### shellcode

指发生缓冲区溢出攻击时，程序的执行被转移到攻击者提供的、保存在发生溢出的缓冲区中的代码，是机器代码，依赖特定的处理器结构（特定的操作系统)。

特点
1）代码内容中不包含绝对地址，必须为浮动地址。不可能预先准确定位。
2）代码中不能包含NULL字符。空字符为串结束符, shellcode内部含有null字符将使代码不完整。
3）代码短小，以便能填入buffer



### NOP

- 解决不能准确定位shellcode代码初始地址问题。
- 在攻击代码ShellCode前包括若干NOP指令，如果指针指向NOP,执行将继续往下直到获得攻击代码。
- 攻击者只要指定的ret地址在这些NOP指令所在的存储单元地址中，最终就可以执行shellcode。



## 缓冲区利用

实现缓冲区溢出攻击步骤
1．寻找脆弱性函数

2．发现有缓冲区溢出漏洞的代码

3．设计一个可被执行的漏洞或攻击点程序shellcode

4．设置Return指针,以便能被指回进入执行堆栈

### Ret2Libc  return to libc

从软件及其依赖库借库函数， 比如, system() . exec()、mprotect()函数

在栈中准备好库函数的参数和首地址

溢出时修改函数的返回地址





### ROP return oriented programming



### 指针欺骗



### 整数溢出



### Metasploit





# 操作系统

## 安全机制

### 访问控制

三要素

- 主体：访问操作系统的主动发起者
- 客体：信息的载体，接收信息的实体
- 安全访问规则：客体对主体的条件约束



### 隔离控制

逻辑隔离，虚拟内存技术，虚拟机技术

### 用户认证

### 文件保护

### 存储保护



## 安全内核

- 覆盖性
- 隔离性
- 统一性
- 可修改性
- 紧凑型
- 可验证性

安全内核缺陷

- 影响系统性能
- 非完备性

引用监视器是安全内核中最重要的部分，但不是唯一的安全机制

- 含义。访问控制的集合



可信计算基TCB

- TCB是计算基系统内的所有保护机制的总称，一起实施统一的系统安全策略，建立一个基本的保护环境
- TCB是一个概念



# 安全模型

BLP模型：是军事安全策略的形式化描述，识别机密性允许的通信，是并发处理不同敏感登记数据的系统的设计基础

三个特性

- 简单的安全特性：禁止往上读
- *-特性：禁止往下写
- 稳定特性：对象被计算基系统处理时，其安全等级不会被改变

BLP模型应用示例

- 防火墙实现单向的访问机制：不允许敏感数据从内部网络流向Internet

缺点

- 只能处理机密性保护问题
- 不能防止或解决隐蔽通道问题（即在不违反安全策略的基础上实现信息的非法流动和获取的通信信道）
- 没有修改访问权限的机制



Biba完整性模型

BLP关注机密性，没有考虑完整性

Biba是BLP的对立面，允许上读下写



# windows安全

安全标示符SID

用户账号：包括口令、安全标识符、组成员关系、登录限制

- 组：通用组、全局组、本地组

- SID：用户或者组的安全ID，系统分配每个组或者用户唯一的SID

- 有计算机名、当前时间、当前用户态的CPU耗费时间的总和保证SID的唯一性

- 表示形式：S-1-N-Y1-Y2-Y3-Y4

- 知名SID：

  Y4为000001F4（500）：administrator

  000001F5（501）：guest账号

- 查询命令 whoami/user



安全访问令牌:用户通过验证后，本地安全授权服务器LSA为用户创建的、访问系统资源的票证

- 主要有：用户账号的SID、安全的组的SIDs、访问权限列表

用户访问系统资源时，出示访问令牌，系统检查所访问资源对象上的访问控制列表

改变用户的访问权限需要注销后重新登录，重新获取访问令牌



对象的安全描述符SD

- 是对象的属性之一，用来保存对象的安全配置
- Owner SID
- Group SIDs
- 访问控制列表
- 审计记录



注册表

注册表是一个层次结构数据库，包含大量windows配置信息  键值对



活动目录

- 存储网络对象信息的数据库，采用LDAP轻量级目录访问协议查询和更新活动目录
- 域用户只需要登陆一次，全网使用资源



NetBIOS：名称解析系统，位于OSI模型的会话层，完成大量的内部联网。

使用netstat命令

net命令





# 数据库安全

安全需求

- 可靠性、完整性保护
- 可审计性
- 访问控制
- 敏感数据保护，维持机密性和精确度的平衡
- 用户认证



## 数据库完整性保护

- 物理完整性：指DBMS维护事务日志，在故障点重建数据库 ，使得数据库中数据不受电源故障影响
-  逻辑完整性：指保护数据库结构，如果修改其中某个域的值不会影响其他域

数据库完整性由DBMS、操作系统、计算系统管理员共同维护

保护方法

![image-20221024233215272](img/image-20221024233215272.png)